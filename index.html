<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>ROM Tracker – YouMOVE</title>
<style>
  :root { --bg:#0b1016; --card:#121820; --muted:#8aa0b2; --text:#eaf2f8; --accent:#50c878; --danger:#ff6b6b; --warn:#ffc857; --flash:#50c878; }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  body{margin:0;background:linear-gradient(180deg,#0b1016,#0e141c);color:var(--text)}
  .wrap{max-width:960px;margin:0 auto;padding:16px 14px 40px}
  header{display:flex;align-items:center;gap:12px;justify-content:space-between;margin:6px 0 14px}
  h1{font-size:22px;margin:0}
  .card{background:var(--card);border:1px solid #1d2732;border-radius:18px;padding:14px;margin:10px 0;box-shadow:0 6px 24px rgba(0,0,0,.28)}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  select, input[type="text"], button, input[type="number"]{width:100%;padding:12px 12px;border-radius:12px;border:1px solid #203040;background:#0b1118;color:var(--text);font-size:15px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .btn{cursor:pointer;transition:transform .02s ease,opacity .2s}
  .btn:active{transform:scale(.98)}
  .btn.primary{background:var(--accent);color:#072d19;border-color:#0d5b3a;font-weight:700}
  .btn.warn{background:var(--warn);color:#432; border-color:#a77}
  .btn.ghost{background:#0a121a;border-color:#1d2a38}
  .kpi{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px}
  .tile{background:#0a121a;border:1px solid #1d2a38;border-radius:16px;padding:14px;text-align:center}
  .tile h3{margin:4px 0 0;font-size:24px}
  .tile span{font-size:12px;color:var(--muted)}
  .muted{color:var(--muted)}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#0f1b23;padding:10px 14px;border-radius:10px;border:1px solid #1f2f3a;box-shadow:0 6px 20px rgba(0,0,0,.4);display:none;z-index:999}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>YouMOVE – Deine Gelenkbewegung: privat, souverän und vollkommen cloudfrei </h1>
    <div class="flex">
      <button id="btnEnable" class="btn ghost">Enable Sensors</button>
      <button id="btnCalibrate" class="btn ghost">Set Zero</button>
      <button id="btnResetMinMax" class="btn ghost">Reset Min/Max</button>
    </div>
  </header>

  <div class="card">
    <div class="row">
      <div>
        <label>Joint</label>
        <select id="joint">
          <option>Shoulder</option>
          <option>Elbow</option>
          <option>Wrist</option>
          <option>Hip</option>
          <option>Knee</option>
          <option>Ankle</option>
          <option>Rest</option>
        </select>
      </div>
      <div>
        <label>Plane / Movement</label>
        <select id="plane">
          <option value="beta">Flexion/Extension (β)</option>
          <option value="gamma">Abduction/Adduction (γ)</option>
          <option value="alpha">Rotation (α)</option>
        </select>
      </div>
    </div>
    <div class="row">
      <div>
        <label>Side</label>
        <select id="side">
          <option>Right</option>
          <option>Left</option>
          <option>Midline</option>
        </select>
      </div>
      <div>
        <label>Notes (optional)</label>
        <input id="notes" type="text" placeholder="e.g., post-op wk 2">
      </div>
    </div>
  </div>

  <div class="card">
    <div class="kpi">
      <div class="tile"><span>Angle (°)</span><h3 id="angle">—</h3></div>
      <div class="tile"><span>Max (°)</span><h3 id="max">—</h3></div>
      <div class="tile"><span>Min (°)</span><h3 id="min">—</h3></div>
      <div class="tile"><span>Zero Ref (°)</span><h3 id="zero">—</h3></div>
      <div class="tile"><span>Mean (°)</span><h3 id="mean">—</h3></div>
      <div class="tile"><span>Joint / Rest</span><h3 id="jointRest">—</h3></div>
    </div>
    <div class="flex" style="margin-top:10px;">
      <button id="btnStart" class="btn primary">Start</button>
      <button id="btnStop" class="btn warn">Stop</button>
      <button id="btnSave" class="btn">Save</button>
      <span class="pill right" id="sensorStatus">Sensors: idle</span>
    </div>
  </div>

  <div class="card">
    <strong>Manual Mode</strong>
    <div class="row" style="margin-top:8px;">
      <div>
        <label>Set angle manually (°)</label>
        <input id="manualAngle" type="text" placeholder="e.g., 92.5">
      </div>
      <div class="flex" style="align-items:flex-end">
        <button id="btnApplyManual" class="btn">Apply</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>
</div>

<script>
(function(){
  const ui = {
    angle: document.getElementById('angle'),
    min: document.getElementById('min'),
    max: document.getElementById('max'),
    zero: document.getElementById('zero'),
    mean: document.getElementById('mean'),
    jointRest: document.getElementById('jointRest'),
    sensorStatus: document.getElementById('sensorStatus'),
    btnEnable: document.getElementById('btnEnable'),
    btnCalibrate: document.getElementById('btnCalibrate'),
    btnResetMinMax: document.getElementById('btnResetMinMax'),
    btnStart: document.getElementById('btnStart'),
    btnStop: document.getElementById('btnStop'),
    btnSave: document.getElementById('btnSave'),
    joint: document.getElementById('joint'),
    plane: document.getElementById('plane'),
    side: document.getElementById('side'),
    notes: document.getElementById('notes'),
    manualAngle: document.getElementById('manualAngle'),
    btnApplyManual: document.getElementById('btnApplyManual'),
    toast: document.getElementById('toast')
  };

  let running = false, zero = 0, min = Infinity, max = -Infinity, currentAngle = 0, listenerAdded=false;
  let sessionSamples = [];

  function showToast(txt, ms=1200){ ui.toast.textContent=txt; ui.toast.style.display='block'; setTimeout(()=>ui.toast.style.display='none', ms); }

  function isIOS(){ return /iPad|iPhone|iPod/.test(navigator.userAgent); }

  async function enableSensors(){
    try{
      if(isIOS() && typeof DeviceMotionEvent.requestPermission==='function'){
        const res = await DeviceMotionEvent.requestPermission();
        if(res!=='granted') throw new Error('Permission denied');
      }
      if(!listenerAdded){
        window.addEventListener('deviceorientation', onOrient, true);
        listenerAdded=true;
      }
      ui.sensorStatus.textContent='Sensors: ready';
      showToast('Sensors enabled');
    }catch{
      ui.sensorStatus.textContent='Sensors: blocked';
      showToast('Permission denied, use manual mode');
    }
  }

  function getAxisAngle(alpha,beta,gamma,plane){
    switch(plane){
      case 'alpha': return ((alpha+540)%360)-180;
      case 'beta': return beta;
      case 'gamma': return gamma;
      default: return 0;
    }
  }

  function onOrient(e){
    if(!running) return;
    const a=e.alpha||0, b=e.beta||0, g=e.gamma||0;
    const raw = getAxisAngle(a,b,g,ui.plane.value)-zero;
    currentAngle = ((raw+180)%360)-180;
    if(currentAngle>max) max=currentAngle;
    if(currentAngle<min) min=currentAngle;
    sessionSamples.push(currentAngle);
    updateKPI();
  }

  function updateKPI(){
    ui.angle.textContent = currentAngle.toFixed(1);
    ui.min.textContent = isFinite(min)?min.toFixed(1):'—';
    ui.max.textContent = isFinite(max)?max.toFixed(1):'—';
    ui.zero.textContent = zero.toFixed(1);
    const mean = sessionSamples.length ? sessionSamples.reduce((a,b)=>a+b,0)/sessionSamples.length : 0;
    ui.mean.textContent = sessionSamples.length?mean.toFixed(1):'—';
    ui.jointRest.textContent = ui.joint.value.includes('Rest') ? 'Rest':'Active';
  }

  ui.btnEnable.addEventListener('click', enableSensors);
  ui.btnStart.addEventListener('click', ()=>{ running=true; showToast('Measuring…'); });
  ui.btnStop.addEventListener('click', ()=>{ running=false; showToast('Stopped'); });
  ui.btnResetMinMax.addEventListener('click', ()=>{ min=Infinity; max=-Infinity; updateKPI(); showToast('Min/Max reset'); });
  ui.btnCalibrate.addEventListener('click', ()=>{ zero=currentAngle; updateKPI(); showToast('Zero set'); });
  ui.btnApplyManual.addEventListener('click', ()=>{
    const v=parseFloat(ui.manualAngle.value.replace(',','.'));
    if(isNaN(v)){ return alert('Enter valid number'); }
    currentAngle=v; if(v>max) max=v; if(v<min) min=v;
    sessionSamples.push(v); updateKPI();
  });
})();
</script>
</body>
</html>
